<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>test.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-action.html">action</a><ul class='methods'><li data-type='method'><a href="module-action.html#.add">add</a></li><li data-type='method'><a href="module-action.html#.addAsync">addAsync</a></li><li data-type='method'><a href="module-action.html#.move">move</a></li><li data-type='method'><a href="module-action.html#.moveAsync">moveAsync</a></li><li data-type='method'><a href="module-action.html#.remove">remove</a></li><li data-type='method'><a href="module-action.html#.removeAsync">removeAsync</a></li></ul></li><li><a href="module-app.html">app</a><ul class='methods'><li data-type='method'><a href="module-app.html#.getDeps">getDeps</a></li><li data-type='method'><a href="module-app.html#~getFeatureRoutes">getFeatureRoutes</a></li><li data-type='method'><a href="module-app.html#~getFeatures">getFeatures</a></li><li data-type='method'><a href="module-app.html#~getFeatureStructure">getFeatureStructure</a></li><li data-type='method'><a href="module-app.html#~getRootRoutePath">getRootRoutePath</a></li><li data-type='method'><a href="module-app.html#~getSrcFiles">getSrcFiles</a></li></ul></li><li><a href="module-component.html">component</a><ul class='methods'><li data-type='method'><a href="module-component.html#.add">add</a></li><li data-type='method'><a href="module-component.html#.remove">remove</a></li><li data-type='method'><a href="module-component.html#.remove">remove</a></li></ul></li><li><a href="module-constant.html">constant</a><ul class='methods'><li data-type='method'><a href="module-constant.html#.add">add</a></li><li data-type='method'><a href="module-constant.html#.remove">remove</a></li><li data-type='method'><a href="module-constant.html#.rename">rename</a></li></ul></li><li><a href="module-feature.html">feature</a><ul class='methods'><li data-type='method'><a href="module-feature.html#.add">add</a></li><li data-type='method'><a href="module-feature.html#.move">move</a></li><li data-type='method'><a href="module-feature.html#.remove">remove</a></li></ul></li><li><a href="module-refactor.html">refactor</a><ul class='methods'><li data-type='method'><a href="module-refactor.html#.addExportFrom">addExportFrom</a></li><li data-type='method'><a href="module-refactor.html#.addImportFrom">addImportFrom</a></li><li data-type='method'><a href="module-refactor.html#.addToArray">addToArray</a></li><li data-type='method'><a href="module-refactor.html#.removeFromArray">removeFromArray</a></li><li data-type='method'><a href="module-refactor.html#.renameClassName">renameClassName</a></li><li data-type='method'><a href="module-refactor.html#.renameFunctionName">renameFunctionName</a></li><li data-type='method'><a href="module-refactor.html#.renameIdentifier">renameIdentifier</a></li></ul></li><li><a href="module-rekit-core.html">rekit-core</a><ul class='methods'><li data-type='method'><a href="module-rekit-core.html#.addAction">addAction</a></li><li data-type='method'><a href="module-rekit-core.html#.addAsyncAction">addAsyncAction</a></li><li data-type='method'><a href="module-rekit-core.html#.addComponent">addComponent</a></li><li data-type='method'><a href="module-rekit-core.html#.addFeature">addFeature</a></li><li data-type='method'><a href="module-rekit-core.html#.handleCommand">handleCommand</a></li><li data-type='method'><a href="module-rekit-core.html#.moveAction">moveAction</a></li><li data-type='method'><a href="module-rekit-core.html#.moveAsyncAction">moveAsyncAction</a></li><li data-type='method'><a href="module-rekit-core.html#.moveComponent">moveComponent</a></li><li data-type='method'><a href="module-rekit-core.html#.moveFeature">moveFeature</a></li><li data-type='method'><a href="module-rekit-core.html#.removeAction">removeAction</a></li><li data-type='method'><a href="module-rekit-core.html#.removeAsyncAction">removeAsyncAction</a></li><li data-type='method'><a href="module-rekit-core.html#.removeComponent">removeComponent</a></li><li data-type='method'><a href="module-rekit-core.html#.removeFeature">removeFeature</a></li></ul></li><li><a href="module-style.html">style</a><ul class='methods'><li data-type='method'><a href="module-style.html#.add">add</a></li><li data-type='method'><a href="module-style.html#.remove">remove</a></li><li data-type='method'><a href="module-style.html#.remove">remove</a></li></ul></li><li><a href="module-template.html">template</a><ul class='methods'><li data-type='method'><a href="module-template.html#.generate">generate</a></li><li data-type='method'><a href="module-template.html#.readTemplate">readTemplate</a></li></ul></li><li><a href="module-test.html">test</a><ul class='methods'><li data-type='method'><a href="module-test.html#.add">add</a></li><li data-type='method'><a href="module-test.html#.addAction">addAction</a></li><li data-type='method'><a href="module-test.html#.move">move</a></li><li data-type='method'><a href="module-test.html#.moveAction">moveAction</a></li><li data-type='method'><a href="module-test.html#.remove">remove</a></li><li data-type='method'><a href="module-test.html#.removeAction">removeAction</a></li></ul></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method'><a href="module-utils.html#.joinPath">joinPath</a></li><li data-type='method'><a href="module-utils.html#.mapSrcFile">mapSrcFile</a></li><li data-type='method'><a href="module-utils.html#.setSilent">setSilent</a></li><li data-type='method'><a href="module-utils.html#~error">error</a></li><li data-type='method'><a href="module-utils.html#~fatalError">fatalError</a></li><li data-type='method'><a href="module-utils.html#~getActionType">getActionType</a></li><li data-type='method'><a href="module-utils.html#~getAsyncActionTypes">getAsyncActionTypes</a></li><li data-type='method'><a href="module-utils.html#~getFullPath">getFullPath</a></li><li data-type='method'><a href="module-utils.html#~getPkgJson">getPkgJson</a></li><li data-type='method'><a href="module-utils.html#~getProjectRoot">getProjectRoot</a></li><li data-type='method'><a href="module-utils.html#~getRelativePath">getRelativePath</a></li><li data-type='method'><a href="module-utils.html#~log">log</a></li><li data-type='method'><a href="module-utils.html#~setPkgJson">setPkgJson</a></li><li data-type='method'><a href="module-utils.html#~setProjectRoot">setProjectRoot</a></li><li data-type='method'><a href="module-utils.html#~warn">warn</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#nearestCharAfter">nearestCharAfter</a></li><li><a href="global.html#nearestCharBefore">nearestCharBefore</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">test.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * Unit test manager. Manages tests for actions/reducers and components. Usually used with action/component manager.
 * @module
**/

const _ = require('lodash');
const utils = require('./utils');
const vio = require('./vio');
const refactor = require('./refactor');
const template = require('./template');

/**
 * Add the unit test boilerplate file for a component.
 * @param {string} feature - The feature name.
 * @param {string} name - The component name.
 * @param {Object} [args] - The args passed to rekit-core/template.
 * @param {string} [args.templateFile=Component.test.js] - The template file to create test file.

 * @alias module:test.add
 *
 * @example
 * const test = require('rekit-core').test;
 * test.add('home', 'Hello');
 *
 * // Result => Create the unit test boilerplate file at: 'tests/features/home/Hello.test.js'.
**/
function add(feature, component, args) {
  args = args || {};
  template.generate(utils.mapComponentTestFile(feature, component), Object.assign({}, args, {
    templateFile: args.templateFile || 'Component.test.js',
    context: Object.assign({ feature, component }, args.context || {}),
  }));
}

/**
 * Remove the unit test file for a component.
 * @param {string} feature - The feature name.
 * @param {string} name - The component name.

 * @alias module:test.remove
 *
 * @example
 * const test = require('rekit-core').test;
 * test.remove('home', 'Hello');
 *
 * // Result => Delete the test file of: 'tests/features/home/Hello.test.js'.
**/
function remove(feature, component) {
  vio.del(utils.mapComponentTestFile(feature, component));
}

/**
 * Move/rename the unit test file for a component.
 * @param {ElementArg} source - Which component test to move.
 * @param {ElementArg} target - The target location of the component test.

 * @alias module:test.move
**/
function move(source, target) {
  source.feature = _.kebabCase(source.feature);
  source.name = _.pascalCase(source.name);
  target.feature = _.kebabCase(target.feature);
  target.name = _.pascalCase(target.name);

  const srcPath = utils.mapComponentTestFile(source.feature, source.name);
  const targetPath = utils.mapComponentTestFile(target.feature, target.name);
  vio.move(srcPath, targetPath);

  const oldCssClass = `.${_.kebabCase(source.feature)}-${_.kebabCase(source.name)}`;
  const newCssClass = `.${_.kebabCase(target.feature)}-${_.kebabCase(target.name)}`;

  // Note: below string pattern binds to the test template, update here if template is changed.
  // Two styles of imports for component and high order component like page.
  const oldImportPath1 = `src/features/${_.kebabCase(source.feature)}`;
  const newImportPath1 = `src/features/${_.kebabCase(target.feature)}`;

  const oldImportPath2 = `src/features/${_.kebabCase(source.feature)}/${_.pascalCase(source.name)}`;
  const newImportPath2 = `src/features/${_.kebabCase(target.feature)}/${_.pascalCase(target.name)}`;

  // Try to update describe('xxx')
  const oldDescribe = `${_.kebabCase(source.feature)}/${_.pascalCase(source.name)}`;
  const newDescribe = `${_.kebabCase(target.feature)}/${_.pascalCase(target.name)}`;

  refactor.updateFile(targetPath, ast => [].concat(
    refactor.renameImportSpecifier(ast, source.name, target.name),
    refactor.renameStringLiteral(ast, oldImportPath1, newImportPath1),
    refactor.renameStringLiteral(ast, oldImportPath2, newImportPath2),
    refactor.renameStringLiteral(ast, oldDescribe, newDescribe),
    refactor.renameStringLiteral(ast, oldCssClass, newCssClass)
  ));
}

/**
 * Add the unit test boilerplate file for an action (using different templates for sync or async).
 * @param {string} feature - The feature name.
 * @param {string} name - The action name.
 * @param {Object} [args] - The args passed to rekit-core/template.
 * @param {string} [args.templateFile=Component.test.js] - The template file to create test file.
 * @param {string} [args.isAsync=false] - Whether the action is async.

 * @alias module:test.addAction
 *
 * @example
 * const test = require('rekit-core').test;
 * test.addAction('home', 'doSomething', { isAsync: true });
 *
 * // Result => Create the unit test boilerplate file at: 'tests/features/home/redux/doSomething.test.js'.
**/
function addAction(feature, name, args) {
  args = args || {};
  const context = {
    feature,
    action: name,
  };
  if (args.isAsync) {
    context.actionTypes = utils.getAsyncActionTypes(feature, name);
  } else {
    context.actionType = args.actionType || utils.getActionType(feature, name);
  }
  template.generate(utils.mapReduxTestFile(feature, name), Object.assign({}, args, {
    templateFile: args.templateFile || (args.isAsync ? 'redux/async_action.test.js' : 'redux/action.test.js'),
    context: Object.assign(context, args.context || {}),
  }));
}

/**
 * Remove the unit test file for an action (either sync or async).
 * @param {string} feature - The feature name.
 * @param {string} name - The action name.

 * @alias module:test.removeAction
 *
**/
function removeAction(feature, name) {
  vio.del(utils.mapReduxTestFile(feature, name));
}

/**
 * Move/rename the unit test file for an action.
 * @param {ElementArg} source - Which action test to move.
 * @param {ElementArg} target - The target location of the action test.
 * @param {Object} [args] - Only used to indicates if it's async.
 * @param {Object} [args.isAsync=false] - Whether it's an async action.

 * @alias module:test.moveAction
**/
function moveAction(source, target, args) {
  args = args || {};
  source.feature = _.kebabCase(source.feature);
  source.name = _.camelCase(source.name);
  target.feature = _.kebabCase(target.feature);
  target.name = _.camelCase(target.name);

  const srcPath = utils.mapReduxTestFile(source.feature, source.name);
  const targetPath = utils.mapReduxTestFile(target.feature, target.name);
  vio.move(srcPath, targetPath);

  // Note: below string pattern binds to the test template, update here if template is changed.
  // For action/reducer import
  const oldImportPath1 = `src/features/${source.feature}/redux/${source.name}`;
  const newImportPath1 = `src/features/${target.feature}/redux/${target.name}`;

  // For constant import
  const oldImportPath2 = `src/features/${source.feature}/redux/constants`;
  const newImportPath2 = `src/features/${target.feature}/redux/constants`;

  // Try to update describe('xxx')
  const oldDescribe = `${source.feature}/redux/${source.name}`;
  const newDescribe = `${target.feature}/redux/${target.name}`;

  const ast = vio.getAst(targetPath);
  let changes = [].concat(
    refactor.renameImportSpecifier(ast, source.name, target.name),
    refactor.renameStringLiteral(ast, oldImportPath1, newImportPath1),
    refactor.renameStringLiteral(ast, oldImportPath2, newImportPath2),
    refactor.renameStringLiteral(ast, oldDescribe, newDescribe)
  );

  if (args.isAsync) {
    const oldActionTypes = utils.getAsyncActionTypes(source.feature, source.name);
    const newActionTypes = utils.getAsyncActionTypes(target.feature, target.name);

    const oldIt1 = `dispatches success action when ${_.camelCase(source.name)} succeeds`;
    const newIt1 = `dispatches success action when ${_.camelCase(target.name)} succeeds`;

    const oldIt2 = `dispatches failure action when ${_.camelCase(source.name)} fails`;
    const newIt2 = `dispatches failure action when ${_.camelCase(target.name)} fails`;

    const oldIt3 = `returns correct action by dismiss${_.pascalCase(source.name)}Error`;
    const newIt3 = `returns correct action by dismiss${_.pascalCase(target.name)}Error`;

    const oldIt4 = `handles action type ${oldActionTypes.begin} correctly`;
    const newIt4 = `handles action type ${newActionTypes.begin} correctly`;

    const oldIt5 = `handles action type ${oldActionTypes.success} correctly`;
    const newIt5 = `handles action type ${newActionTypes.success} correctly`;

    const oldIt6 = `handles action type ${oldActionTypes.failure} correctly`;
    const newIt6 = `handles action type ${newActionTypes.failure} correctly`;

    const oldIt7 = `handles action type ${oldActionTypes.dismissError} correctly`;
    const newIt7 = `handles action type ${newActionTypes.dismissError} correctly`;

    changes = changes.concat(
      refactor.renameImportSpecifier(ast, `dismiss${_.pascalCase(source.name)}Error`, `dismiss${_.pascalCase(target.name)}Error`),
      refactor.renameImportSpecifier(ast, `${oldActionTypes.begin}`, `${newActionTypes.begin}`),
      refactor.renameImportSpecifier(ast, `${oldActionTypes.success}`, `${newActionTypes.success}`),
      refactor.renameImportSpecifier(ast, `${oldActionTypes.failure}`, `${newActionTypes.failure}`),
      refactor.renameImportSpecifier(ast, `${oldActionTypes.dismissError}`, `${newActionTypes.dismissError}`),
      refactor.renameStringLiteral(ast, oldIt1, newIt1),
      refactor.renameStringLiteral(ast, oldIt2, newIt2),
      refactor.renameStringLiteral(ast, oldIt3, newIt3),
      refactor.renameStringLiteral(ast, oldIt4, newIt4),
      refactor.renameStringLiteral(ast, oldIt5, newIt5),
      refactor.renameStringLiteral(ast, oldIt6, newIt6),
      refactor.renameStringLiteral(ast, oldIt7, newIt7)
    );
  } else {
    // Try to update it('xxx') for sync action, bound to the templates

    const oldActionType = utils.getActionType(source.feature, source.name);
    const newActionType = utils.getActionType(target.feature, target.name);
    const oldIt1 = `returns correct action by ${source.name}`;
    const newIt1 = `returns correct action by ${target.name}`;

    const oldIt2 = `handles action type ${oldActionType} correctly`;
    const newIt2 = `handles action type ${newActionType} correctly`;
    changes = changes.concat(
      refactor.renameStringLiteral(ast, oldIt1, newIt1),
      refactor.renameStringLiteral(ast, oldIt2, newIt2),
      refactor.renameImportSpecifier(ast, oldActionType, newActionType)
    );
  }
  let code = vio.getContent(targetPath);
  code = refactor.updateSourceCode(code, changes);
  vio.save(targetPath, code);
}

module.exports = {
  add,
  remove,
  move,
  addAction,
  removeAction,
  moveAction,
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Jul 09 2017 00:09:43 GMT+0800 (CST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
